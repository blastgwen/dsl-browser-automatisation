grammar com.selenium.gram.xtext.SlnDsl with org.eclipse.xtext.common.Terminals

generate slnDsl "http://www.selenium.com/gram/xtext/SlnDsl"

/*
 * Le modele
 */
Model:
	subs+=Subprocedure*
	'main' 
	body=Body 
	'endmain'
;
	
Subprocedure:
	'sub' head=Head 
	body=Body	
	'endsub'
	;

Body:
	defs+=Definition*
	instructions+=Instruction+
;

Head:
	name=FunctionName '()' 
	| name=FunctionName '(' 'var' argsID+=VariableName (',' 'var' argsID+=VariableName )* ')'
;

/*
 * Subprocedure
 */
FunctionReference:
	functionName=[FunctionName]
;

FunctionName:
	name=ID
;

FunctionCall:
	ref=FunctionReference '()' 
	| ref=FunctionReference '(' args+=Expression (',' args+=Expression)* ')'
;

/*
 * Variables
 */
VariableReference:
	varID=[VariableName]
;

VariableName:
	name=ID
;

NumberLiteral:
	INT | STRING
;

/*
 * Expression
 */

Expression:
	VariableReference
	| NumLiteralExpression
	| ListExpression
	| BooleanExpression
	| ActionSelectExpression
;	

NumLiteralExpression:
	value = NumberLiteral
;

ListExpression :
	'sizeof' '(' exp=Expression ')'
;

BooleanListExpression :
	 op=BooleanListOperator '(' 'var'  varName=VariableName '->' exp=Expression ')'
;

BooleanListOperator:
	'All' | 'Any'
;

BooleanExpression :
	exp=BinaryBooleanExpression
	| exp=NegationExpression
	| exp=VerifyAction
	| exp=ExistAction
	| exp=BooleanListExpression
	| exp=BooleanValue
	| exp=BinaryLogicalExpression
	| exp=VariableReference
;

BooleanValue:
	value=BOOLEAN
;

terminal BOOLEAN:
	'true' | 'false'
;

VerifyAction :
	'verify' '(' nameElement=NumberLiteral ',' value=Expression ')'
;

ExistAction :
	'exist' '(' nameElement = NumberLiteral ')'
;

BinaryBooleanExpression:
	op=BooleanOperator left=Expression right=Expression
;

BinaryLogicalExpression:
 	op=LogicalOperator left=BooleanExpression right=BooleanExpression 
;

NegationExpression :
	'!' negation = BooleanExpression
;

LogicalOperator:
	'&&' | '||'
;

BooleanOperator :
	('=='|'<'|'>')
;

/*
 * Type of Instruction
 */
Instruction:
	FunctionCall 
	| Conditional
	| Loop
	| ActionInstruction
	| Assignation
;

Definition:
	'var' varID=VariableName '=' exp=Expression
;

Assignation:
	var=VariableReference '=' exp=Expression
;

Conditional:
	'if' exp=BooleanExpression 'then' trueIns+=Instruction+ ('else' falseIns+=Instruction+)? 'endif'
;

/*
 * Loop et Conditional
 */

Loop:
	While
	| Foreach
;

While:
	'while' '(' cond=BooleanExpression ')' 'do' ins+=Instruction+ 'endwhile'
;
Foreach:
	'foreach' '(' var=VariableName 'in' exp=Expression ')' 'do' ins+=Instruction+ 'endfor'
;

ActionInstruction:
	action=ActionOpen
	| action=ActionClick
	| action=ActionCheck
	| action=ActionType
;

ActionClick:
	'click' '(' type=ClickableElement ',' element=NumberLiteral ')'
;

ActionOpen:
	'open' '(' url=URL ')'
;

ActionCheck:
	'check' '('element=Expression ',' value=BooleanExpression')'
;

ActionType:
	'type' '(' nameElement=Expression ',' value=Expression ')'
;
ActionSelectExpression :
	'select' '(' element=Expression ')'
;

ClickableElement:
	('button'|'image'| 'link');
/*
 * URL
 */
terminal URL:
    
    ('a'..'z')+ '://' // Protocol
 
    ( // Hostname
        (
            ('0'..'9')+ '.' ('0'..'9')+ '.' ('0'..'9')+ '.' ('0'..'9')+
        ) |
        (
            ('a'..'z'|'A'..'Z')
            (
                'a'..'z'|'A'..'Z'|
                '0'..'9'|
                '$'|
                '-'|
                '_'|
                (
                    '\\'
                    ('0'..'9'|'a'..'f'|'A'..'F')
                    ('0'..'9'|'a'..'f'|'A'..'F')
                ) |
                (
                    '%'
                    ('0'..'9')
                    ('0'..'9')
                )
            )*
            (
                '.'
                ('a'..'z'|'A'..'Z')
                (
                    'a'..'z'|'A'..'Z'|
                    '0'..'9'|
                    '$'|
                    '-'|
                    '_'|
                    (
                        '\\'
                        ('0'..'9'|'a'..'f'|'A'..'F')
                        ('0'..'9'|'a'..'f'|'A'..'F')
                    ) |
                    (
                        '%'
                        ('0'..'9')
                        ('0'..'9')
                    )
                )*
            )*
        )
    )
    (':' ('0'..'9')+)? // Portnumber
 
    ('/'
        (
            'a'..'z'|'A'..'Z'|
            '0'..'9'|
            '$'|
            '-'|
            '_'|
            '~'|
            '+'|
            '.'|
            (
                '\\'
                ('0'..'9'|'a'..'f'|'A'..'F')
                ('0'..'9'|'a'..'f'|'A'..'F')
            ) |
            (
                '%'
                ('0'..'9')
                ('0'..'9')
            )
        )*
    )* // Path
 
    ('?'
        (
            'a'..'z'|'A'..'Z'|
            '0'..'9'|
            '$'|
            '-'|
            '_'|
            '='|
            '&'|
            ';'|
            (
                '\\'
                ('0'..'9'|'a'..'f'|'A'..'F')
                ('0'..'9'|'a'..'f'|'A'..'F')
            ) |
            (
                '%'
                ('0'..'9')
                ('0'..'9')
            )
        )+
 
        ('+'
            (
                'a'..'z'|'A'..'Z'|
                '0'..'9'|
                '$'|
                '-'|
                '_'|
                '='|
                '&'|
                ';'|
                (
                    '\\'
                    ('0'..'9'|'a'..'f'|'A'..'F')
                    ('0'..'9'|'a'..'f'|'A'..'F')
                ) |
                (
                    '%'
                    ('0'..'9')
                    ('0'..'9')
                )
            )+
        )*
    )?; 